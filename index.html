<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œæ—¥ç¨‹å®‰æ’ - ä¸“ä¸šç‰ˆ</title>
    <style>
        :root {
            /* é…è‰²æ–¹æ¡ˆ - æ·¡é›…é£æ ¼ */
            --primary-color: #6366f1;       /* ä¸»è‰²è°ƒï¼šé›è“ */
            --primary-hover: #4f46e5;       /* ä¸»è‰²æ‚¬åœ */
            --bg-gradient-start: #f3f4f6;   /* èƒŒæ™¯æ¸å˜å§‹ */
            --bg-gradient-end: #e0e7ff;     /* èƒŒæ™¯æ¸å˜ç»ˆ */
            --text-main: #1f2937;           /* ä¸»è¦æ–‡å­— */
            --text-secondary: #6b7280;      /* æ¬¡è¦æ–‡å­— */
            --border-color: #e5e7eb;        /* è¾¹æ¡†é¢œè‰² */
            --white: #ffffff;
            --danger: #ef4444;              /* åˆ é™¤è‰² */
            --today-highlight: #fff7ed;     /* ä»Šå¤©é«˜äº®èƒŒæ™¯ */
            --today-border: #f97316;        /* ä»Šå¤©è¾¹æ¡†è‰² */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius-md: 12px;
            --radius-lg: 24px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--text-main);
            min-height: 100vh;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: start;
        }

        /* ä¸»å®¹å™¨ */
        .app-container {
            width: 100%;
            max-width: 1100px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 2rem;
            animation: fadeIn 0.5s ease;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-main);
            letter-spacing: -0.5px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background: #f9fafb;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
        }

        .month-display {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 140px;
            text-align: center;
            user-select: none;
        }

        button.nav-btn {
            background: var(--white);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        button.nav-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            box-shadow: var(--shadow-sm);
        }

        /* æ—¥å†ç½‘æ ¼ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .weekday-header {
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 0.8rem 0;
            font-size: 0.9rem;
        }

        .day-cell {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            min-height: 110px;
            padding: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden; /* å…³é”®ä¿®å¤ï¼šé™åˆ¶å†…å®¹æº¢å‡º */
        }

        .day-cell:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
            z-index: 10;
        }

        /* ç°è‰²çš„éæœ¬æœˆæ—¥æœŸ */
        .day-cell.faded {
            background-color: #f9fafb;
            color: #d1d5db;
        }
        .day-cell.faded .day-number { color: #d1d5db; }
        .day-cell.faded:hover { cursor: default; transform: none; box-shadow: none; border-color: var(--border-color); }

        /* ä»Šå¤©é«˜äº® */
        .day-cell.today {
            background-color: var(--today-highlight);
            border: 2px solid var(--today-border);
        }

        .day-number {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        .day-cell.today .day-number {
            color: var(--today-border);
        }

        /* æ—¥ç¨‹æ¡ç›®å¾®ä»¶ */
        .task-badge {
            background: var(--primary-color);
            color: white;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 6px;
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
            opacity: 0.9;
            max-width: 100%; /* å…³é”®ä¿®å¤ï¼šé™åˆ¶å®½åº¦ */
        }
        
        .task-more {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: center;
        }

        /* å¼¹çª—ç³»ç»Ÿ */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-card {
            background: var(--white);
            width: 100%;
            max-width: 480px;
            border-radius: var(--radius-lg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal-card {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.5rem;
            background: #f9fafb;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 { font-size: 1.25rem; color: var(--text-main); }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            line-height: 1;
        }

        .modal-body { padding: 1.5rem; }

        .form-group { margin-bottom: 1.5rem; }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        textarea.input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        textarea.input-field:focus { border-color: var(--primary-color); }

        .task-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            animation: slideIn 0.2s;
            word-break: break-word; /* å…³é”®ä¿®å¤ï¼šå…è®¸é•¿æ–‡æœ¬æ¢è¡Œ */
        }

        .task-text { 
            flex: 1; 
            margin-right: 1rem; 
            font-size: 0.95rem; 
            word-break: break-word; /* å…³é”®ä¿®å¤ï¼šå…è®¸é•¿æ–‡æœ¬æ¢è¡Œ */
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        
        .btn-danger { background: #fee2e2; color: var(--danger); padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        .btn-danger:hover { background: #fecaca; }

        .modal-footer {
            padding: 1.5rem;
            background: #f9fafb;
            text-align: right;
            border-top: 1px solid var(--border-color);
        }

        /* åŠ¨ç”» */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

        /* å…³é”®ä¿®å¤ï¼šé™åˆ¶æ—¥ç¨‹æ˜¾ç¤ºæ•°é‡å’Œé«˜åº¦ */
        .day-cell .schedules-container {
            max-height: 60px; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
            overflow-y: auto;
            margin-top: 5px;
        }

        .day-cell .schedules-container::-webkit-scrollbar {
            width: 4px;
        }

        .day-cell .schedules-container::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>ğŸ“… å·¥ä½œæ—¥ç¨‹å®‰æ’</h1>
        <div class="controls">
            <button class="nav-btn" id="prevMonth" title="ä¸Šä¸€ä¸ªæœˆ">â®</button>
            <div class="month-display" id="currentMonthDisplay"></div>
            <button class="nav-btn" id="nextMonth" title="ä¸‹ä¸€ä¸ªæœˆ">â¯</button>
        </div>
    </header>

    <div class="calendar-grid" id="calendarGrid">
        <div class="weekday-header">å‘¨æ—¥</div>
        <div class="weekday-header">å‘¨ä¸€</div>
        <div class="weekday-header">å‘¨äºŒ</div>
        <div class="weekday-header">å‘¨ä¸‰</div>
        <div class="weekday-header">å‘¨å››</div>
        <div class="weekday-header">å‘¨äº”</div>
        <div class="weekday-header">å‘¨å…­</div>
    </div>
</div>

<div class="modal-overlay" id="scheduleModal">
    <div class="modal-card">
        <div class="modal-header">
            <h3 id="modalTitle">è®¾ç½®æ—¥ç¨‹</h3>
            <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">ğŸ“ æ–°å¢å¾…åŠäº‹é¡¹</label>
                <textarea class="input-field" id="scheduleInput" placeholder="è¯·è¾“å…¥å·¥ä½œå®‰æ’... (æŒ‰ Ctrl+Enter ä¿å­˜)"></textarea>
            </div>
            
            <label class="form-label">ğŸ“… å½“æ—¥æ—¥ç¨‹åˆ—è¡¨</label>
            <div class="task-list" id="taskList">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="addSchedule()">ä¿å­˜æ—¥ç¨‹</button>
        </div>
    </div>
</div>

<script>
    /**
     * å·¥ä½œæ—¥ç¨‹å°ç¨‹åºæ ¸å¿ƒé€»è¾‘
     * 1. ä½¿ç”¨ LocalStorage æŒä¹…åŒ–æ•°æ®
     * 2. ä¸¥è°¨çš„æ—¥æœŸè®¡ç®—é€»è¾‘
     */

    // çŠ¶æ€ç®¡ç†
    const state = {
        currentDate: new Date(), // å½“å‰æ˜¾ç¤ºçš„æœˆä»½è§†è§’
        selectedDate: null,      // å½“å‰ç‚¹å‡»é€‰ä¸­çš„æ—¥æœŸ
        schedules: JSON.parse(localStorage.getItem('workSchedules') || '{}')
    };

    // DOM å…ƒç´ å¼•ç”¨
    const dom = {
        grid: document.getElementById('calendarGrid'),
        monthDisplay: document.getElementById('currentMonthDisplay'),
        modal: document.getElementById('scheduleModal'),
        modalTitle: document.getElementById('modalTitle'),
        input: document.getElementById('scheduleInput'),
        taskList: document.getElementById('taskList')
    };

    // åˆå§‹åŒ–
    function init() {
        // ç»‘å®šå¯¼èˆªäº‹ä»¶
        document.getElementById('prevMonth').addEventListener('click', () => changeMonth(-1));
        document.getElementById('nextMonth').addEventListener('click', () => changeMonth(1));
        
        // ç»‘å®šå¿«æ·é”®
        dom.input.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') addSchedule();
        });

        // ç»‘å®šå¼¹çª—å…³é—­
        dom.modal.addEventListener('click', (e) => {
            if (e.target === dom.modal) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && dom.modal.classList.contains('active')) closeModal();
        });

        renderCalendar();
    }

    // åˆ‡æ¢æœˆä»½
    function changeMonth(delta) {
        // å…³é”®ä¿®å¤ï¼šé˜²æ­¢"å¤§æœˆåƒå°æœˆ"é—®é¢˜ï¼ˆå¦‚1æœˆ31æ—¥å‡ä¸€ä¸ªæœˆå¦‚æœä¸è®¾ä¸º1å·å¯èƒ½å˜æˆ3æœˆï¼‰
        // é€»è¾‘ï¼šè®¾ç½®ä¸ºç›®æ ‡æœˆçš„ç¬¬ä¸€å¤©
        const targetDate = new Date(state.currentDate.getFullYear(), state.currentDate.getMonth() + delta, 1);
        state.currentDate = targetDate;
        renderCalendar();
    }

    // æ¸²æŸ“æ—¥å†ä¸»å‡½æ•°
    function renderCalendar() {
        const year = state.currentDate.getFullYear();
        const month = state.currentDate.getMonth();
        const today = new Date();

        // æ›´æ–°å¤´éƒ¨
        dom.monthDisplay.textContent = `${year}å¹´ ${month + 1}æœˆ`;

        // æ¸…ç†æ—§æ ¼å­ï¼ˆä¿ç•™å‰7ä¸ªè¡¨å¤´ï¼‰
        while (dom.grid.children.length > 7) {
            dom.grid.removeChild(dom.grid.lastChild);
        }

        // è®¡ç®—æ—¥æœŸå‚æ•°
        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const startDayOfWeek = firstDayOfMonth.getDay(); // 0 æ˜¯å‘¨æ—¥

        // å¡«å……ä¸Šä¸ªæœˆçš„å°¾å·´ï¼ˆç°è‰²ï¼‰
        const prevMonthDays = new Date(year, month, 0).getDate();
        for (let i = startDayOfWeek - 1; i >= 0; i--) {
            createDayCell(prevMonthDays - i, true);
        }

        // å¡«å……å½“æœˆ
        for (let i = 1; i <= daysInMonth; i++) {
            const isToday = (i === today.getDate() && month === today.getMonth() && year === today.getFullYear());
            createDayCell(i, false, isToday);
        }

        // å¡«å……ä¸‹ä¸ªæœˆçš„å¤´ï¼ˆè¡¥é½ 6 è¡Œï¼Œæ€»å…± 42 ä¸ªæ ¼å­ï¼‰
        const totalCellsFilled = startDayOfWeek + daysInMonth;
        const remainingCells = 42 - totalCellsFilled;
        for (let i = 1; i <= remainingCells; i++) {
            createDayCell(i, true);
        }
    }

    // åˆ›å»ºå•ä¸ªæ—¥æœŸæ ¼
    function createDayCell(dayNumber, isFaded, isToday = false) {
        const cell = document.createElement('div');
        cell.className = `day-cell ${isFaded ? 'faded' : ''} ${isToday ? 'today' : ''}`;
        
        // æ„é€ æ—¥æœŸ Key (YYYY-MM-DD)
        const currentYear = state.currentDate.getFullYear();
        const currentMonth = state.currentDate.getMonth();
        // æ³¨æ„ï¼šå¦‚æœæ˜¯ fadedï¼ˆä¸Š/ä¸‹æœˆï¼‰ï¼Œéœ€è¦è®¡ç®—æ­£ç¡®çš„å¹´æœˆï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼š
        // ä»…å½“æœˆæ—¥æœŸå…è®¸ç‚¹å‡»æ·»åŠ æ—¥ç¨‹ï¼Œéå½“æœˆæ—¥æœŸä»…åšå±•ç¤º
        let dateKey = '';
        
        if (!isFaded) {
            dateKey = formatDateKey(currentYear, currentMonth, dayNumber);
            cell.onclick = () => openModal(dateKey);
        }

        // æ¸²æŸ“æ—¥æœŸæ•°å­—
        const numberEl = document.createElement('div');
        numberEl.className = 'day-number';
        numberEl.textContent = dayNumber;
        cell.appendChild(numberEl);

        // å¦‚æœæœ‰æ—¥ç¨‹ï¼Œæ˜¾ç¤ºæ‘˜è¦
        if (!isFaded && state.schedules[dateKey] && state.schedules[dateKey].length > 0) {
            const list = state.schedules[dateKey];
            
            // åˆ›å»ºä¸€ä¸ªå®¹å™¨æ¥é™åˆ¶æ—¥ç¨‹æ˜¾ç¤º
            const schedulesContainer = document.createElement('div');
            schedulesContainer.className = 'schedules-container';
            
            // æœ€å¤šæ˜¾ç¤º2æ¡ï¼Œå¤šäº†æ˜¾ç¤º "è¿˜æœ‰ x é¡¹"
            list.slice(0, 2).forEach(item => {
                const badge = document.createElement('div');
                badge.className = 'task-badge';
                badge.textContent = item.text;
                schedulesContainer.appendChild(badge);
            });
            
            if (list.length > 2) {
                const more = document.createElement('div');
                more.className = 'task-more';
                more.textContent = `è¿˜æœ‰ ${list.length - 2} é¡¹...`;
                schedulesContainer.appendChild(more);
            }
            
            cell.appendChild(schedulesContainer);
        }

        dom.grid.appendChild(cell);
    }

    // æ‰“å¼€å¼¹çª—
    function openModal(dateKey) {
        state.selectedDate = dateKey;
        const [y, m, d] = dateKey.split('-');
        dom.modalTitle.textContent = `${y}å¹´${parseInt(m)+1}æœˆ${d}æ—¥ - æ—¥ç¨‹å®‰æ’`;
        dom.input.value = '';
        dom.input.focus();
        dom.modal.classList.add('active');
        renderTaskList();
    }

    // å…³é—­å¼¹çª—
    function closeModal() {
        dom.modal.classList.remove('active');
        state.selectedDate = null;
    }

    // æ¸²æŸ“å¼¹çª—å†…çš„ä»»åŠ¡åˆ—è¡¨
    function renderTaskList() {
        dom.taskList.innerHTML = '';
        const list = state.schedules[state.selectedDate] || [];

        if (list.length === 0) {
            dom.taskList.innerHTML = '<div style="text-align:center;color:#9ca3af;padding:20px;">æš‚æ— å®‰æ’</div>';
            return;
        }

        list.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `
                <div class="task-text">${escapeHtml(item.text)}</div>
                <button class="btn btn-danger" onclick="deleteSchedule(${index})">åˆ é™¤</button>
            `;
            dom.taskList.appendChild(div);
        });
    }

    // æ·»åŠ æ—¥ç¨‹
    function addSchedule() {
        const text = dom.input.value.trim();
        if (!text) return;

        if (!state.schedules[state.selectedDate]) {
            state.schedules[state.selectedDate] = [];
        }

        state.schedules[state.selectedDate].push({
            id: Date.now(), // ç®€å•å”¯ä¸€ID
            text: text
        });

        saveAndRefresh();
        dom.input.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†ä»¥ä¾¿è¿ç»­è¾“å…¥
    }

    // åˆ é™¤æ—¥ç¨‹
    window.deleteSchedule = function(index) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ—¥ç¨‹å—ï¼Ÿ')) return;
        state.schedules[state.selectedDate].splice(index, 1);
        // å¦‚æœæ•°ç»„ç©ºäº†ï¼Œæ¸…ç†key
        if (state.schedules[state.selectedDate].length === 0) {
            delete state.schedules[state.selectedDate];
        }
        saveAndRefresh();
    };

    // æŒä¹…åŒ–å¹¶åˆ·æ–°è§†å›¾
    function saveAndRefresh() {
        localStorage.setItem('workSchedules', JSON.stringify(state.schedules));
        renderCalendar(); // åˆ·æ–°æ—¥å†å¤–æ˜¾
        renderTaskList(); // åˆ·æ–°åˆ—è¡¨
    }

    // è¾…åŠ©ï¼šç”Ÿæˆæ—¥æœŸ Key
    function formatDateKey(year, month, day) {
        return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }

    // è¾…åŠ©ï¼šé˜²XSSè½¬ä¹‰
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // å¯åŠ¨
    init();
</script>
</body>
</html>

